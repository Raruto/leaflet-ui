{"version":3,"file":"leaflet-ui.js","sources":["../src/leaflet-ui.js"],"sourcesContent":["import { version } from '../package.json';\r\n\r\nlet L = window.L = window.L || {};\r\n\r\nL.plugins = [\r\n\t'leaflet-i18n@0.3.1/Leaflet.i18n.js',\r\n\t'leaflet-rotate@0.1.4/dist/leaflet-rotate.js',\r\n\t'@raruto/leaflet-gesture-handling@1.4.1/dist/leaflet-gesture-handling.min.js',\r\n\t'leaflet.visualclick@1.1.4/dist/L.VisualClick.js',\r\n\r\n\t'leaflet.locatecontrol@0.76.0/src/L.Control.Locate.js',\r\n\t// 'leaflet.fullscreen@2.2.0/Control.FullScreen.js',\r\n\t// '../node_modules/leaflet.fullscreen/Control.FullScreen.js',\r\n\t'leaflet-pegman@0.1.6/leaflet-pegman.min.js',\r\n\t'@raruto/leaflet-edit-osm@0.0.2/leaflet-edit-osm.min.js',\r\n\t'leaflet-control-layers-inline@0.0.7/leaflet-control-layers-inline.min.js',\r\n\t'leaflet-minimap@3.6.1/dist/Control.MiniMap.min.js',\r\n\t'leaflet-loading@0.1.24/src/Control.Loading.js',\r\n\t'leaflet-search@3.0.2/dist/leaflet-search.min.js',\r\n\t'leaflet-easyprint@2.1.9/dist/bundle.js',\r\n\t'leaflet.control.resizer@0.0.1/L.Control.Resizer.js',\r\n];\r\n\r\nL.import = (plugins, base_url = 'https://unpkg.com/') => typeof plugins == 'string' ? import(base_url + plugins) : Promise.all(plugins.map(d => import(base_url + d)));\r\n\r\nL.initUI = () => {\r\n\r\n\t/* Temporary fix for empty values evaluated as false (leaflet-i18n v0.3.1) */\r\n\t(function(){\r\n\t\tlet proto = L.i18n.bind({});\r\n\t\tL.i18n = L._ = (string, data) => {\r\n\t\t\tif (L.locale && L.locales[L.locale] && L.locales[L.locale][string] == \"\") {\r\n\t\t\t\tL.locales[L.locale][string] = \"\\u200B\";\r\n\t\t\t}\r\n\t\t\treturn proto.call(null, string, data);\r\n\t\t};\r\n\t})();\r\n\r\n\t(function() {\r\n\r\n\t\tconst currentScript = document.currentScript;\r\n\t\tconst currentVersion = version.split(\"+\")[0].trim();\r\n\r\n\t\tlet lazyLoader = {\r\n\r\n\t\t\tbaseURL: 'https://unpkg.com/',\r\n\r\n\t\t\t// Sequentially download multiple scripts.\r\n\t\t\tloadSyncScripts: function(urls) {\r\n\t\t\t\treturn urls.reduce((prev, curr) => prev.then(() => lazyLoader.loadAsyncScripts(curr)), Promise.resolve());\r\n\t\t\t},\r\n\r\n\t\t\t// Parallel download multiple scripts.\r\n\t\t\tloadAsyncScripts: function(urls) {\r\n\t\t\t\treturn Promise.all(urls.map((url) => lazyLoader.loadScript(url)));\r\n\t\t\t},\r\n\r\n\t\t\t// Dynamically load a single script.\r\n\t\t\tloadScript: function(url) {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\r\n\t\t\t\t\tlet type = url.split('.').pop().split('?')[0];\r\n\t\t\t\t\tlet tag = type == 'css' ? 'link' : 'script';\r\n\t\t\t\t\tlet script = document.createElement(tag);\r\n\t\t\t\t\tlet head = document.head;\r\n\t\t\t\t\tlet root_script = (head.contains(currentScript) ? currentScript : head.lastChild) || head;\r\n\t\t\t\t\tlet prev_tag = lazyLoader[\"prev_\" + tag] || (tag == 'script' && lazyLoader.prev_link ? lazyLoader.prev_link : root_script);\r\n\t\t\t\t\tlet base_url = (url.indexOf(\".\") === 0 || url.indexOf(\"/\") === 0 || url.indexOf('http://') === 0 || url.indexOf('https://') === 0) ? '' : lazyLoader.baseURL;\r\n\r\n\t\t\t\t\tif (type == 'css') {\r\n\t\t\t\t\t\tscript.rel = 'stylesheet';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tscript.addEventListener('load', resolve, { once: true });\r\n\t\t\t\t\tscript.setAttribute(type == 'css' ? 'href' : 'src', base_url + url);\r\n\r\n\t\t\t\t\tif (prev_tag.parentNode && prev_tag.nextSibling)\r\n\t\t\t\t\t\tprev_tag.parentNode.insertBefore(script, prev_tag.nextSibling);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\thead.appendChild(script);\r\n\r\n\t\t\t\t\tlazyLoader[\"prev_\" + tag] = script;\r\n\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\t// You can ovveride them by passing one of the following to leaflet map constructor.\r\n\t\tlet default_options = {\r\n\t\t\tmapTypes: {\r\n\t\t\t\tatlas: {\r\n\t\t\t\t\tname: 'Atlas',\r\n\t\t\t\t\turl: 'https://{s}.tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png',\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tmaxZoom: 24,\r\n\t\t\t\t\t\tmaxNativeZoom: 22,\r\n\t\t\t\t\t\tattribution: 'Map data: &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> | Map style: &copy; <a href=\"http://www.thunderforest.com/\">Thunderforest</a>',\r\n\t\t\t\t\t\t// apikey: '<your apikey>',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tstreets: {\r\n\t\t\t\t\tname: 'Streets',\r\n\t\t\t\t\turl: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tmaxZoom: 24,\r\n\t\t\t\t\t\tmaxNativeZoom: 19,\r\n\t\t\t\t\t\tattribution: 'Map data: &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tcycle: {\r\n\t\t\t\t\tname: 'Cycle',\r\n\t\t\t\t\turl: 'https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png',\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tmaxZoom: 24,\r\n\t\t\t\t\t\tmaxNativeZoom: 22,\r\n\t\t\t\t\t\tattribution: 'Map data: &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> | Map style: &copy; <a href=\"http://www.thunderforest.com/\">Thunderforest</a>',\r\n\t\t\t\t\t\t// apikey: '<your apikey>',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tterrain: {\r\n\t\t\t\t\tname: 'Terrain',\r\n\t\t\t\t\turl: 'https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png',\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tmaxZoom: 24,\r\n\t\t\t\t\t\tmaxNativeZoom: 22,\r\n\t\t\t\t\t\tattribution: 'Map data: &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> | Map style: &copy; <a href=\"http://www.thunderforest.com/\">Thunderforest</a>',\r\n\t\t\t\t\t\t// apikey: '<your apikey>',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tsatellite: {\r\n\t\t\t\t\tname: 'Satellite',\r\n\t\t\t\t\turl: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tmaxZoom: 24,\r\n\t\t\t\t\t\tmaxNativeZoom: 18,\r\n\t\t\t\t\t\tattribution: 'Map data: &copy; <a href=\"http://www.esri.com/\">Esri</a> &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\ttopo: {\r\n\t\t\t\t\tname: 'Topo',\r\n\t\t\t\t\turl: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tmaxZoom: 24,\r\n\t\t\t\t\t\tmaxNativeZoom: 17,\r\n\t\t\t\t\t\tattribution: 'Map data: &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>, <a href=\"http://viewfinderpanoramas.org\">SRTM</a> | Map style: &copy; <a href=\"https://opentopomap.org\">OpenTopoMap</a> (<a href=\"https://creativecommons.org/licenses/by-sa/3.0/\">CC-BY-SA</a>)',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tzoomControl: {\r\n\t\t\t\tposition: 'bottomright'\r\n\t\t\t},\r\n\t\t\trotateControl: {\r\n\t\t\t\tposition: 'bottomright',\r\n\t\t\t},\r\n\t\t\tscaleControl: {\r\n\t\t\t\twidth: 200,\r\n\t\t\t\tposition: 'bottomright',\r\n\t\t\t\timperial: false,\r\n\t\t\t},\r\n\t\t\tpegmanControl: {\r\n\t\t\t\tposition: 'bottomright',\r\n\t\t\t\ttheme: \"leaflet-pegman-v3-small\",\r\n\t\t\t},\r\n\t\t\tlocateControl: {\r\n\t\t\t\tposition: \"bottomright\"\r\n\t\t\t},\r\n\t\t\tfullscreenControl: {\r\n\t\t\t\tposition: 'topright',\r\n\t\t\t\ttitle: 'Enter Fullscreen',\r\n\t\t\t\ttitleCancel: 'Exit Fullscreen',\r\n\t\t\t\tforceSeparateButton: true,\r\n\t\t\t},\r\n\t\t\tlayersControl: {\r\n\t\t\t\tinline: true,\r\n\t\t\t\tposition: 'topleft'\r\n\t\t\t},\r\n\t\t\tminimapControl: {\r\n\t\t\t\tposition: 'bottomleft',\r\n\t\t\t\ttoggleDisplay: false,\r\n\t\t\t\ttoggleMapTypes: true, // Automatically switch between \"satellite\" and \"roads\" layers.\r\n\t\t\t\twidth: 75,\r\n\t\t\t\theight: 75,\r\n\t\t\t\taimingRectOptions: {\r\n\t\t\t\t\tcolor: '#000000',\r\n\t\t\t\t\tweight: 1,\r\n\t\t\t\t\topacity: 0,\r\n\t\t\t\t\tfillOpacity: 0,\r\n\t\t\t\t},\r\n\t\t\t\tshadowRectOptions: {\r\n\t\t\t\t\tcolor: '#000000',\r\n\t\t\t\t\tweight: 1,\r\n\t\t\t\t\topacity: 0,\r\n\t\t\t\t\tfillOpacity: 0,\r\n\t\t\t\t},\r\n\t\t\t\tmapOptions: {\r\n\t\t\t\t\tmapTypeId: 'satellite',\r\n\t\t\t\t\tgestureHandling: false,\r\n\t\t\t\t\tsearchControl: false,\r\n\t\t\t\t\tloadingControl: false,\r\n\t\t\t\t\t_isMiniMap: true,\r\n\t\t\t\t\trotateControl: false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\teditInOSMControl: {\r\n\t\t\t\tposition: \"bottomright\"\r\n\t\t\t},\r\n\t\t\tloadingControl: {\r\n\t\t\t\tseparate: true,\r\n\t\t\t\tposition: 'bottomright'\r\n\t\t\t},\r\n\t\t\tsearchControl: {\r\n\t\t\t\turl: 'https://nominatim.openstreetmap.org/search?format=json&accept-language={querylang}&q={s}',\r\n\t\t\t\tquerylang: 'en-US',\r\n\t\t\t\tdetectUserLang: true,\r\n\t\t\t\tjsonpParam: 'json_callback',\r\n\t\t\t\tpropertyName: 'display_name',\r\n\t\t\t\tpropertyLoc: ['lat', 'lon'],\r\n\t\t\t\tmarkerLocation: true,\r\n\t\t\t\tautoType: false,\r\n\t\t\t\tautoCollapse: true,\r\n\t\t\t\tfirstTipSubmit: true,\r\n\t\t\t\tminLength: 1,\r\n\t\t\t\tzoom: 10,\r\n\t\t\t\tposition: \"bottomright\",\r\n\t\t\t},\r\n\t\t\tprintControl: {\r\n\t\t\t\tposition: 'bottomright',\r\n\t\t\t\thideControlContainer: true,\r\n\t\t\t\texportOnly: true,\r\n\t\t\t\tsizeModes: [ /*'Current',*/ 'A4Portrait', 'A4Landscape'],\r\n\t\t\t\t//tileWait: 1200,\r\n\t\t\t},\r\n\t\t\tresizerControl: {\r\n\t\t\t\tdirection: 's'\r\n\t\t\t},\r\n\t\t\tdisableDefaultUI: false,\r\n\t\t\t// TODO: pluginsBaseURL: 'https://unpkg.com/',\r\n\t\t\tplugins: [\r\n\t\t\t\t// \"@raruto/leaflet-elevation@0.4.5/leaflet-elevation.css\",\r\n\t\t\t\t// \"@raruto/leaflet-elevation@0.4.5/leaflet-elevation.js\",\r\n\t\t\t\t// \"leaflet-kmz@0.3.1/dist/leaflet-kmz.js\",\r\n\t\t\t\t// \"leaflet-transparency@0.0.5/leaflet-transparency.min.js\"\r\n\t\t\t],\r\n\t\t\t_isMiniMap: false, // used to prevent infinite loops when loading the minimap control.\r\n\t\t};\r\n\r\n\t\t// See \"default_options\" for a complete list of allowed values.\r\n\t\tL.Map.mergeOptions({\r\n\t\t\tmapTypeId: 'streets',\r\n\t\t\tmapTypeIds: ['streets', 'terrain', 'satellite', 'topo'],\r\n\t\t\tmapTypes: undefined,\r\n\t\t\tgestureHandling: true,\r\n\t\t\tvisualClick: true,\r\n\t\t\tzoomControl: true,\r\n\t\t\tscaleControl: true,\r\n\t\t\tpegmanControl: true,\r\n\t\t\tlocateControl: true,\r\n\t\t\tfullscreenControl: true,\r\n\t\t\tlayersControl: true,\r\n\t\t\tminimapControl: true,\r\n\t\t\teditInOSMControl: true,\r\n\t\t\tloadingControl: true,\r\n\t\t\tsearchControl: true,\r\n\t\t\tprintControl: false,\r\n\t\t\tresizerControl: false,\r\n\t\t\tdisableDefaultUI: false,\r\n\t\t\tincludeLeafletCSS: true,\r\n\t\t\tincludeLeafletUICSS: true,\r\n\t\t\tapiKeys: undefined, // eg. { thunderforest: \"\", google: \"\", ... }\r\n\t\t\t_isMiniMap: false, // used to prevent infinite loops when loading the minimap control.\r\n\t\t});\r\n\r\n\t\t// Customize leaflet Map default aspect.\r\n\t\tL.Map.addInitHook(function() {\r\n\t\t\tdisableDefaultUI.call(this);\r\n\t\t\tif (this.options._isMiniMap) {\r\n\t\t\t\treturn; // prevent infinite loops when loading the minimap control.\r\n\t\t\t}\r\n\t\t\tif (!this.options.disableDefaultUI) {\r\n\t\t\t\tsetDefaultOptions.call(this);\r\n\t\t\t\tinitMap.call(this);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Disable leaflet map default controls.\r\n\t\tfunction disableDefaultUI() {\r\n\t\t\tif (this.zoomControl) this.zoomControl.remove();\r\n\t\t\tif (this.rotateControl) this.rotateControl.remove();\r\n\t\t\tif (this.fullscreenControl && this.options.fullscreenControl && !this.options.zoomControl) this.fullscreenControl.remove();\r\n\t\t\tif (this.searchControl && this.options.searchControl) this.searchControl.remove();\r\n\t\t\tif (this.attributionControl) this.attributionControl.remove();\r\n\t\t}\r\n\r\n\t\t// Deep merge \"default_options\" and do some sanity check.\r\n\t\tfunction setDefaultOptions() {\r\n\t\t\tlet opts = this.options;\r\n\r\n\t\t\t// Recursive merge leaflet map options.\r\n\t\t\tfor (let i in default_options) {\r\n\t\t\t\tif (opts[i] === true || typeof opts[i] === \"undefined\") {\r\n\t\t\t\t\topts[i] = default_options[i];\r\n\t\t\t\t} else if (typeof this.options[i] === \"object\" && opts[i] instanceof Array === false) {\r\n\t\t\t\t\topts[i] = deepMerge(default_options[i], opts[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Set deafult tile providers Api Keys (if any).\r\n\t\t\tif (opts.apiKeys) {\r\n\t\t\t\tif (opts.apiKeys.thunderforest) {\r\n\t\t\t\t\topts.mapTypes.atlas.options.apikey   = opts.apiKeys.thunderforest;\r\n\t\t\t\t\topts.mapTypes.terrain.options.apikey = opts.apiKeys.thunderforest;\r\n\t\t\t\t\topts.mapTypes.cycle.options.apikey   = opts.apiKeys.thunderforest;\r\n\t\t\t\t}\r\n\t\t\t\tif (opts.apiKeys.google) {\r\n\t\t\t\t\topts.pegmanControl.apiKey = opts.apiKeys.google;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Append Api Keys (query string).\r\n\t\t\tfor (let k of ['atlas', 'terrain', 'cycle']) {\r\n\t\t\t\tif (opts.mapTypes[k].options.apikey && opts.mapTypes[k].url.indexOf('apikey=') === -1) {\r\n\t\t\t\t\topts.mapTypes[k].url += (opts.mapTypes[k].url.indexOf('?') === -1 ? '?' : '&') + 'apikey={apikey}';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Fix default mapTypeId if missing in mapTypeIds array.\r\n\t\t\tif (opts.mapTypeIds.includes(opts.mapTypeId) === false && opts.mapTypeIds.length > 0) {\r\n\t\t\t\topts.mapTypeId = opts.mapTypeIds[0];\r\n\t\t\t}\r\n\t\t\t// Auto detect user \"querylang\" value when using search control.\r\n\t\t\tif (opts.searchControl && opts.searchControl.detectUserLang) {\r\n\t\t\t\topts.searchControl.querylang = window.navigator.languages ? window.navigator.languages[0] : (window.navigator.userLanguage || window.navigator.language);\r\n\t\t\t}\r\n\t\t\t// Replace default \"querylang\" value when using search control.\r\n\t\t\tif (opts.searchControl && opts.searchControl.querylang) {\r\n\t\t\t\topts.searchControl.url = opts.searchControl.url.replace('{querylang}', opts.searchControl.querylang);\r\n\t\t\t}\r\n\t\t\t// Avoid missing center/zoom values when using minimap control.\r\n\t\t\tif (opts.minimapControl && !opts.center && !opts.zoom) {\r\n\t\t\t\tthis.setView([0, 0], 0);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Initialize default leaflet map controls and layers.\r\n\t\tfunction initMap() {\r\n\t\t\tlet controls = {},\r\n\t\t\t\tlayers   = {},\r\n\t\t\t\tbaseMaps = {},\r\n\t\t\t\topts     = this.options;\r\n\r\n\t\t\t// Gesture Handling.\r\n\t\t\tif (opts.gestureHandling) {\r\n\t\t\t\tthis.gestureHandling.enable();\r\n\t\t\t}\r\n\r\n\t\t\t// Load all user selected layers.\r\n\t\t\tfor (let i in opts.mapTypeIds) {\r\n\t\t\t\tlet id = opts.mapTypeIds[i];\r\n\t\t\t\tif (opts.mapTypes[id]) {\r\n\t\t\t\t\tbaseMaps[opts.mapTypes[id].name] = layers[id] = new L.TileLayer(opts.mapTypes[id].url, opts.mapTypes[id].options);\r\n\t\t\t\t\tlayers[id].mapTypeId = id; // save mapTypeId for easy access.\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Keep a reference of previous mapTypeId\r\n\t\t\tthis._lastMapTypeId = opts.mapTypeId;\r\n\t\t\tthis._prevMapTypeId = opts.mapTypeId;\r\n\t\t\tthis.on('baselayerchange', function(e) {\r\n\t\t\t\tif (e && e.layer && e.layer.mapTypeId) {\r\n\t\t\t\t\tthis._prevMapTypeId = this._lastMapTypeId;\r\n\t\t\t\t\tthis._lastMapTypeId = e.layer.mapTypeId;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Keep default baselayers to the lower level\r\n\t\t\tthis.on('baselayerchange', function(e) {\r\n\t\t\t\tif (e && e.layer && e.layer.mapTypeId && e.layer.bringToBack) e.layer.bringToBack();\r\n\t\t\t});\r\n\r\n\t\t\t// Layers Control.\r\n\t\t\tif (opts.layersControl) {\r\n\t\t\t\tcontrols.layers = new L.Control.Layers(baseMaps, null, opts.layersControl);\r\n\t\t\t\tthis.on('zoomend', autoToggleSatelliteLayer, this);\r\n\t\t\t}\r\n\r\n\t\t\t// Attribution Control.\r\n\t\t\tif (opts.attributionControl && this.attributionControl) {\r\n\t\t\t\tthis.attributionControl.addTo(this);\r\n\t\t\t\tcontrols.attribution = this.attributionControl;\r\n\t\t\t\tthis.on('baselayerchange', L.bind(updateLeafletAttribution, this, this.attributionControl.options.prefix));\r\n\t\t\t}\r\n\r\n\t\t\t// Edit in OSM link.\r\n\t\t\tif (opts.editInOSMControl) {\r\n\t\t\t\tcontrols.editInOSM = new L.Control.EditInOSM(opts.editInOSMControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Scale Control.\r\n\t\t\tif (opts.scaleControl) {\r\n\t\t\t\tcontrols.scale = new L.Control.Scale(opts.scaleControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Zoom Control.\r\n\t\t\tif (opts.zoomControl && this.zoomControl) {\r\n\t\t\t\tthis.zoomControl.setPosition(opts.zoomControl.position);\r\n\t\t\t\tthis.zoomControl.addTo(this);\r\n\t\t\t\tcontrols.zoom = this.zoomControl;\r\n\t\t\t}\r\n\r\n\t\t\t// Rotate Control.\r\n\t\t\tif (opts.rotateControl && this.rotateControl) {\r\n\t\t\t\tthis.rotateControl.setPosition(opts.rotateControl.position);\r\n\t\t\t\tthis.rotateControl.addTo(this);\r\n\t\t\t\tcontrols.rotate = this.rotateControl;\r\n\t\t\t}\r\n\r\n\t\t\t// Pegman Control.\r\n\t\t\tif (opts.pegmanControl) {\r\n\t\t\t\tcontrols.pegman = new L.Control.Pegman(opts.pegmanControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Locate Control.\r\n\t\t\tif (opts.locateControl) {\r\n\t\t\t\tcontrols.locate = new L.Control.Locate(opts.locateControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Search Control.\r\n\t\t\tif (opts.searchControl) {\r\n\t\t\t\tcontrols.search = this.searchControl = new L.Control.Search(opts.searchControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Print Control.\r\n\t\t\tif (opts.printControl) {\r\n\t\t\t\tcontrols.print = new L.Control.EasyPrint(opts.printControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Loading Control.\r\n\t\t\tif (opts.loadingControl) {\r\n\t\t\t\tcontrols.loading = new L.Control.Loading(opts.loadingControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Fullscreen Control.\r\n\t\t\tif (opts.fullscreenControl && L.Control.FullScreen) {\r\n\t\t\t\tcontrols.fullscreen = this.fullscreenControl = new L.Control.FullScreen(opts.fullscreenControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Minimap Control.\r\n\t\t\tif (opts.minimapControl) {\r\n\t\t\t\tlet miniMapTypeId = opts.minimapControl.mapOptions.mapTypeId;\r\n\t\t\t\tlet miniMapLayer  = opts.mapTypes[miniMapTypeId];\r\n\t\t\t\tif (miniMapLayer) {\r\n\t\t\t\t\tminiMapLayer = new L.TileLayer(miniMapLayer.url, miniMapLayer.options);\r\n\t\t\t\t\tminiMapLayer.mapTypeId = miniMapTypeId; // save mapTypeId for easy access.\r\n\t\t\t\t\tcontrols.minimap = new L.Control.MiniMap(miniMapLayer, opts.minimapControl);\r\n\t\t\t\t\tcontrols.minimap._mainMapBaseLayers = baseMaps; // save baseMaps for easy access.\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Resizer Control.\r\n\t\t\tif (opts.resizerControl) {\r\n\t\t\t\tcontrols.resizer = new L.Control.Resizer(opts.resizerControl);\r\n\t\t\t}\r\n\r\n\t\t\t// Load all user selected controls.\r\n\t\t\tfor (let i in controls) {\r\n\t\t\t\tif (controls[i].addTo) {\r\n\t\t\t\t\tcontrols[i].addTo(this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.controls = controls; // save controls for easy access.\r\n\r\n\t\t\t// Fire idle event.\r\n\t\t\tthis.whenReady(function() {\r\n\t\t\t\tthis.fire('idle');\r\n\t\t\t\t// Prevent adding multiple default base layers when using multiple maps.\r\n\t\t\t\tif (opts.mapTypeId) {\r\n\t\t\t\t\tlet baseLayer = opts.mapTypes[opts.mapTypeId];\r\n\t\t\t\t\tif (baseLayer && baseMaps[baseLayer.name]) {\r\n\t\t\t\t\t\topts.layers = opts.layers.filter(item => item._leaflet_id !== baseMaps[baseLayer.name]._leaflet_id);\r\n\t\t\t\t\t\tlet layer = baseMaps[baseLayer.name];\r\n\t\t\t\t\t\tif (layer.setZIndex) layer.setZIndex(0);\r\n\t\t\t\t\t\telse if (layer.bringToBack) layer.bringToBack();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\r\n\t\t\t// Set default base layer.\r\n\t\t\tif (opts.mapTypeId) {\r\n\t\t\t\tlet baseLayer = opts.mapTypes[opts.mapTypeId];\r\n\t\t\t\tif (baseLayer && baseMaps[baseLayer.name]) {\r\n\t\t\t\t\topts.layers.unshift(baseMaps[baseLayer.name]); // Add to the array of layers that will be automatically loaded within the map initially.\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Load custom plugins.\r\n\t\t\tif (opts.plugins) {\r\n\t\t\t\tif (!lazyLoader.loader) {\r\n\t\t\t\t\tlet core_plugins = [];\r\n\t\t\t\t\tif (opts.includeLeafletUICSS) {\r\n\t\t\t\t\t\tcore_plugins.unshift(\"leaflet-ui@\" + currentVersion + \"/dist/leaflet-ui.css\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!window.L) {\r\n\t\t\t\t\t\tcore_plugins.unshift(\"leaflet@1.3.4/dist/leaflet.css\");\r\n\t\t\t\t\t\tcore_plugins.unshift(\"leaflet@1.3.4/dist/leaflet.js\");\r\n\t\t\t\t\t} else if (opts.includeLeafletCSS && L.version) {\r\n\t\t\t\t\t\tlet core_css_url = \"leaflet@\" + L.version + \"/dist/leaflet.css\";\r\n\t\t\t\t\t\tlet core_css_exists = false;\r\n\t\t\t\t\t\tfor (let i = 0; i < document.styleSheets.length; i++) {\r\n\t\t\t\t\t\t\tif (document.styleSheets[i].href && document.styleSheets[i].href.indexOf(core_css_url) > 0) {\r\n\t\t\t\t\t\t\t\tcore_css_exists = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!core_css_exists) {\r\n\t\t\t\t\t\t\tcore_plugins.unshift(core_css_url);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlazyLoader.loader = lazyLoader.loadSyncScripts([core_plugins, opts.plugins]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Lazy load initHooks\r\n\t\t\t\tif (this._initHooks) {\r\n\t\t\t\t\tlet initHooks = this._initHooks.length;\r\n\t\t\t\t\tthis.once('plugins_loaded', function() {\r\n\t\t\t\t\t\tif (initHooks < this._initHooks.length)\r\n\t\t\t\t\t\t\tfor (let i = initHooks, len = this._initHooks.length; i < len; i++) {\r\n\t\t\t\t\t\t\t\tthis._initHooks[i].call(this);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.fire('initHooks_called');\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlazyLoader.loader.then(() => this.fire('plugins_loaded'));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Conditionally show leaflet attribution when showing GoogleMutant tiles\r\n\t\tfunction updateLeafletAttribution(defaultAttribution, e) {\r\n\t\t\tif (e && e.layer) {\r\n\t\t\t\tthis.attributionControl.setPrefix((L.GridLayer.GoogleMutant && e.layer instanceof L.GridLayer.GoogleMutant) ? false : defaultAttribution);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Automatically show satellite layer at higher zoom levels\r\n\t\tfunction autoToggleSatelliteLayer(e) {\r\n\t\t\tlet zoom = this.getZoom();\r\n\t\t\tlet control = this.controls.layers;\r\n\t\t\tlet inputs = control._layerControlInputs;\r\n\r\n\t\t\tfor (let i in inputs) {\r\n\t\t\t\tlet input = inputs[i];\r\n\t\t\t\tlet layer = control._getLayer(input.layerId).layer;\r\n\t\t\t\tlet mapTypeId = layer.mapTypeId;\r\n\t\t\t\tif (mapTypeId == \"satellite\") {\r\n\t\t\t\t\tif (zoom >= 18 && !layer._map && !layer._isAutoToggled) {\r\n\t\t\t\t\t\tlayer._isAutoToggled = true;\r\n\t\t\t\t\t\tinput.click();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} else if (zoom < 18 && layer._map && layer._isAutoToggled) {\r\n\t\t\t\t\t\tfor (let j in inputs) {\r\n\t\t\t\t\t\t\tlet input = inputs[j];\r\n\t\t\t\t\t\t\tlet layer = control._getLayer(input.layerId).layer;\r\n\t\t\t\t\t\t\tlet mapTypeId = layer.mapTypeId;\r\n\t\t\t\t\t\t\tif (mapTypeId == this._prevMapTypeId) {\r\n\t\t\t\t\t\t\t\tinput.click();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlayer._isAutoToggled = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} else if (zoom < 18 && !layer._map && layer._isAutoToggled) {\r\n\t\t\t\t\t\tlayer._isAutoToggled = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet minimapProto = L.Control.MiniMap.prototype;\r\n\t\tlet onAddMinimapProto = minimapProto.onAdd;\r\n\r\n\t\t// Customize MiniMap default core behavior.\r\n\t\tL.Control.MiniMap.include({\r\n\t\t\tonAdd: function(map) {\r\n\t\t\t\tlet container = onAddMinimapProto.call(this, map);\r\n\r\n\t\t\t\t// Disable mouse handlers\r\n\t\t\t\tif (this._miniMap) {\r\n\t\t\t\t\tthis._miniMap.doubleClickZoom.disable();\r\n\t\t\t\t\tthis._miniMap.touchZoom.disable();\r\n\t\t\t\t\tthis._miniMap.scrollWheelZoom.disable();\r\n\t\t\t\t}\r\n\t\t\t\t// Automatically switch between \"satellite\" and \"roads\" layers.\r\n\t\t\t\tif (this.options.toggleMapTypes) {\r\n\t\t\t\t\tL.DomEvent.on(map, 'baselayerchange', this._handleMainMapTypeChange, this);\r\n\t\t\t\t\tL.DomEvent.on(this._container, 'click', this._handleMiniMapTypeToggle, this);\r\n\t\t\t\t}\r\n\t\t\t\treturn container;\r\n\t\t\t},\r\n\t\t\t_handleMainMapTypeChange: function(e) {\r\n\t\t\t\tif (!this._handligMiniMapTypeToggle) {\r\n\t\t\t\t\tif (e && e.layer) {\r\n\t\t\t\t\t\tlet minimap = this,\r\n\t\t\t\t\t\t\tmainmap = this._mainMap,\r\n\t\t\t\t\t\t\tminiMapTypeId = minimap._layer.mapTypeId,\r\n\t\t\t\t\t\t\tmainMapTypeId = e.layer.mapTypeId;\r\n\r\n\r\n\t\t\t\t\t\tif (mainmap.options.mapTypeIds.length > 0 && inArray(mainmap.options.mapTypeIds, mainMapTypeId)) {\r\n\t\t\t\t\t\t\tif (mainMapTypeId != miniMapTypeId) {\r\n\t\t\t\t\t\t\t\tminimap._lastMapTypeId = mainMapTypeId;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet mapTypeId,\r\n\t\t\t\t\t\t\t\tminiMapLayer;\r\n\r\n\t\t\t\t\t\t\tif (mainMapTypeId == \"satellite\" && miniMapTypeId == \"satellite\") {\r\n\t\t\t\t\t\t\t\tmapTypeId = minimap._lastMapTypeId;\r\n\t\t\t\t\t\t\t} else if (mainMapTypeId != \"satellite\" && miniMapTypeId != \"satellite\") {\r\n\t\t\t\t\t\t\t\tmapTypeId = \"satellite\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tminiMapLayer = mainmap.options.mapTypes[mapTypeId];\r\n\r\n\t\t\t\t\t\t\tif (miniMapLayer) {\r\n\t\t\t\t\t\t\t\tminiMapLayer = new L.TileLayer(miniMapLayer.url, miniMapLayer.options);\r\n\t\t\t\t\t\t\t\tminiMapLayer.mapTypeId = mapTypeId; // save mapTypeId for easy access.\r\n\t\t\t\t\t\t\t\tminimap._lastMapTypeId = miniMapTypeId;\r\n\t\t\t\t\t\t\t\tminimap.changeLayer(miniMapLayer);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t_handleMiniMapTypeToggle: function() {\r\n\t\t\t\tthis._handligMiniMapTypeToggle = true;\r\n\t\t\t\tif (this._layer && this._mainMapBaseLayers) {\r\n\t\t\t\t\tlet minimap = this,\r\n\t\t\t\t\t\tmainmap = this._mainMap,\r\n\t\t\t\t\t\tminiMapTypeId = this._layer.mapTypeId,\r\n\t\t\t\t\t\tmainMapTypeId;\r\n\t\t\t\t\tfor (let i in this._mainMapBaseLayers) {\r\n\t\t\t\t\t\tif (mainmap.hasLayer(this._mainMapBaseLayers[i]) && miniMapTypeId != this._mainMapBaseLayers[i].mapTypeId) {\r\n\t\t\t\t\t\t\tmainMapTypeId = this._mainMapBaseLayers[i].mapTypeId;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (mainmap.options.mapTypeIds.length > 0 && inArray(mainmap.options.mapTypeIds, miniMapTypeId)) {\r\n\t\t\t\t\t\tlet mapTypeId,\r\n\t\t\t\t\t\t\tminiMapLayer;\r\n\r\n\t\t\t\t\t\tmapTypeId = minimap._lastMapTypeId || mainmap.options.mapTypeId;\r\n\r\n\t\t\t\t\t\tif (minimap._lastMapTypeId != \"satellite\" && miniMapTypeId != \"satellite\") {\r\n\t\t\t\t\t\t\tmapTypeId = \"satellite\";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tminiMapLayer = mainmap.options.mapTypes[mapTypeId];\r\n\r\n\t\t\t\t\t\tif (miniMapLayer) {\r\n\t\t\t\t\t\t\tminiMapLayer = new L.TileLayer(miniMapLayer.url, miniMapLayer.options);\r\n\t\t\t\t\t\t\tminiMapLayer.mapTypeId = mapTypeId; // save mapTypeId for easy access.\r\n\t\t\t\t\t\t\tminimap._lastMapTypeId = miniMapTypeId;\r\n\r\n\t\t\t\t\t\t\tminimap.changeLayer(miniMapLayer);\r\n\r\n\t\t\t\t\t\t\tfor (let i in this._mainMapBaseLayers) {\r\n\t\t\t\t\t\t\t\tthis._mainMapBaseLayers[i].remove();\r\n\t\t\t\t\t\t\t\tif (minimap._lastMapTypeId == this._mainMapBaseLayers[i].mapTypeId) {\r\n\t\t\t\t\t\t\t\t\tthis._mainMapBaseLayers[i].addTo(mainmap);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._handligMiniMapTypeToggle = false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t// Check if an array contains any element from another one.\r\n\t\tfunction inArray(array, items) {\r\n\t\t\treturn array.some(r => items.includes(r));\r\n\t\t}\r\n\r\n\t\t// Simple object check.\r\n\t\tfunction isObject(item) {\r\n\t\t\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n\t\t}\r\n\r\n\t\t// Deep merge two objects (note: circular references not supported).\r\n\t\tfunction deepMerge(target, ...sources) {\r\n\t\t\tif (!sources.length) return target;\r\n\t\t\tconst source = sources.shift();\r\n\t\t\tif (isObject(target) && isObject(source)) {\r\n\t\t\t\tfor (const key in source) {\r\n\t\t\t\t\tif (isObject(source[key])) {\r\n\t\t\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t\t\t[key]: {}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tdeepMerge(target[key], source[key]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn deepMerge(target, ...sources);\r\n\t\t}\r\n\r\n\t})();\r\n\r\n};\r\n\r\nL.init = () => L.version ? L.import(L.plugins).then(L.initUI) : L.import('leaflet@1.7.1/dist/leaflet-src.esm.js').then(m => m.extend(L, m) && L.import(L.plugins).then(L.initUI));\r\n\r\n\r\n"],"names":["L","window","plugins","import","base_url","Promise","all","map","d","initUI","proto","i18n","bind","_","string","data","locale","locales","call","currentScript","document","currentVersion","split","trim","lazyLoader","baseURL","loadSyncScripts","urls","reduce","prev","curr","then","loadAsyncScripts","resolve","url","loadScript","reject","type","pop","tag","script","createElement","head","root_script","contains","lastChild","prev_tag","prev_link","indexOf","rel","addEventListener","once","setAttribute","parentNode","nextSibling","insertBefore","appendChild","default_options","mapTypes","atlas","name","options","maxZoom","maxNativeZoom","attribution","streets","cycle","terrain","satellite","topo","zoomControl","position","rotateControl","scaleControl","width","imperial","pegmanControl","theme","locateControl","fullscreenControl","title","titleCancel","forceSeparateButton","layersControl","inline","minimapControl","toggleDisplay","toggleMapTypes","height","aimingRectOptions","color","weight","opacity","fillOpacity","shadowRectOptions","mapOptions","mapTypeId","gestureHandling","searchControl","loadingControl","_isMiniMap","editInOSMControl","separate","querylang","detectUserLang","jsonpParam","propertyName","propertyLoc","markerLocation","autoType","autoCollapse","firstTipSubmit","minLength","zoom","printControl","hideControlContainer","exportOnly","sizeModes","resizerControl","direction","disableDefaultUI","this","remove","attributionControl","setDefaultOptions","opts","i","Array","deepMerge","apiKeys","thunderforest","apikey","google","apiKey","k","mapTypeIds","includes","length","navigator","languages","userLanguage","language","replace","center","setView","initMap","controls","layers","baseMaps","enable","id","TileLayer","_lastMapTypeId","_prevMapTypeId","on","e","layer","bringToBack","Control","Layers","autoToggleSatelliteLayer","addTo","updateLeafletAttribution","prefix","editInOSM","EditInOSM","scale","Scale","setPosition","rotate","pegman","Pegman","locate","Locate","search","Search","print","EasyPrint","loading","Loading","FullScreen","fullscreen","miniMapTypeId","miniMapLayer","minimap","MiniMap","_mainMapBaseLayers","resizer","Resizer","whenReady","fire","baseLayer","filter","item","_leaflet_id","setZIndex","unshift","loader","core_plugins","includeLeafletUICSS","includeLeafletCSS","version","core_css_url","core_css_exists","styleSheets","href","_initHooks","initHooks","len","defaultAttribution","setPrefix","GridLayer","GoogleMutant","getZoom","control","inputs","_layerControlInputs","input","_getLayer","layerId","_map","_isAutoToggled","click","j","Map","mergeOptions","undefined","visualClick","addInitHook","onAddMinimapProto","prototype","onAdd","inArray","array","items","some","r","isObject","isArray","target","sources","source","shift","key","Object","assign","[object Object]","include","container","_miniMap","doubleClickZoom","disable","touchZoom","scrollWheelZoom","DomEvent","_handleMainMapTypeChange","_container","_handleMiniMapTypeToggle","_handligMiniMapTypeToggle","mainmap","_mainMap","_layer","mainMapTypeId","changeLayer","hasLayer","init","m","extend"],"mappings":"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"}